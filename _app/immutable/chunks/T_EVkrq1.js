import{a0 as me,u as ge,m as ve,b as W,k as T,v as p,w as q,x as m,y as O,e as g,g as Y,j as u,a9 as te,z as pe,d as D,f as P,ac as ne,ag as se}from"./DDtI3ySZ.js";import{p as ce,s as _e,a as ye}from"./hii8YTFM.js";import{i as S}from"./MADWfPdD.js";import{l as le,e as ae,a as re,i as ue,s as E}from"./Bxanz9Be.js";import{R as M,z as he,I as K,e as L,t as I,f as G,g as C,b as be,k as xe,w as we,E as Ae,s as Le,A as d,S as Ie}from"./D2H9T7Pv.js";function We(t,e,a){me(()=>{var r=ge(()=>e(t,a?.())||{});if(r?.destroy)return()=>r.destroy()})}function fe(){return`${Date.now()}-${he().split("-")[0]}`}function Ce(t){const e={id:fe(),name:t,items:[]};M.push(e)}function Ye(t){return M.find(e=>e.id===t)}function Se(t){M.splice(M.indexOf(t),1)}function Ze(t,e){const a=t.items.find(r=>r.id===e);return a||null}function Me(t,e,a){const r=t.items.find(n=>n.id===e);r&&(r.q=a)}function $e(t,e){return t.items.find(a=>a.id===e)?.q||0}function et(t,e){t.items.some(a=>a.id===e)?Me(t,e,(t.items.find(a=>a.id===e)?.q||0)+1):t.items.push({id:e,q:1})}function tt(t,e){if(t.items.some(a=>a.id===e)){const a=t.items.find(r=>r.id===e);a&&(a.q-=1)}t.items=t.items.filter(a=>a.id!==e)}function de(t){return le.compressToEncodedURIComponent(JSON.stringify(t))}function Te(t){try{const e=JSON.parse(le.decompressFromEncodedURIComponent(t));return Array.isArray(e.items)?e:null}catch{return null}}function at(t){const e=Te(t);if(!e)return!1;const a=["id","name","items"];for(const r of a)if(!(r in e))return!1;if(!Array.isArray(e.items))return!1;for(const r of e.items)if(typeof r.id!="string"||typeof r.q!="number")return!1;return!0}function rt(t){const e={...t,id:fe()};return M.push(e),e}var Fe=(t,e,a)=>{e.action&&typeof e.action=="function"&&(t.preventDefault(),e.action(u(a)))},Ve=()=>{},ze=async(t,e)=>{t.preventDefault(),t.stopPropagation(),await we({title:`Alkometriikka - ${u(e).name}`,text:`Katso lista: ${u(e).name}`,url:`${location.origin}/listat?list=${de(u(e))}`})||alert("Linkki kopioitu leikepöydälle!")},De=T('<button><!><span class="hidden md:block">Jaa</span></button>'),Pe=(t,e)=>{t.preventDefault(),t.stopPropagation(),Se(u(e))},qe=T("<button><!></button>"),Oe=T('<a class="flex justify-between items-center gap-2 p-2 border rounded border-primary" tabindex="0"><div class="flex flex-col"><p><span> </span></p> <p><span> </span></p></div> <div class="flex items-center gap-3"><!> <!></div></a>'),Ee=T('<div class="flex flex-col gap-4"></div>'),Ue=T('<div class="prose text-center mx-auto dark:prose-invert"><h2>Ei listoja!</h2> <p>Luo uusi lista alla olevasta painikkeesta!</p></div>'),ke=(t,e)=>e(),Re=T("<div><!> <button><span>Uusi lista</span><!></button></div>");function nt(t,e){W(e,!0);const a=()=>ye(xe,"$searchQuery",r),[r,n]=_e(),o=ce(e,"useSearch",3,!1),i=new Date;function c(){Ce(`Uusi lista - ${i.getDate()}.${i.getMonth()+1}.${i.getFullYear()} ${i.getHours()<10?"0":""}${i.getHours()}.${i.getMinutes()<10?"0":""}${i.getMinutes()}`),be("create_list")}var s=Re(),v=p(s);{var w=h=>{var b=Ee();ae(b,21,()=>M.filter(U=>o()&&a()?ue(U.name,a()):!0),re,(U,f)=>{var x=Oe();x.__click=[Fe,e,f],x.__keydown=[Ve];var k=p(x),F=p(k),V=p(F),N=p(V,!0);m(V),m(F);var z=q(F,2),X=p(z),Z=p(X,!0);m(X),m(z),m(k);var R=q(k,2),J=p(R);{var B=_=>{var l=De();l.__click=[ze,f];var Q=p(l);K(Q,{name:"share",class:"inline-block "}),pe(),m(l),O(ee=>C(l,1,ee),[()=>L(I(G.button({type:"positive",size:"md"}),"aspect-square md:aspect-auto"))]),g(_,l)};S(J,_=>{e.show?.share&&_(B)})}var H=q(J,2);{var $=_=>{var l=qe();l.__click=[Pe,f];var Q=p(l);K(Q,{name:"trash"}),m(l),O(ee=>{E(l,"aria-label",u(f).name),C(l,1,ee)},[()=>L(I(G.button({type:"negative",size:"md"}),"aspect-square w-fit"))]),g(_,l)};S(H,_=>{e.show?.delete&&_($)})}m(R),m(x),O((_,l,Q)=>{E(x,"href",_),E(F,"aria-label",u(f).name),C(F,1,l),te(N,u(f).name),E(z,"aria-label",u(f).name),C(z,1,Q),te(Z,`Tuotteet: ${u(f).items.length}`)},[()=>`/listat?list=${de(u(f))}`,()=>L(I("w-full justify-start text-lg")),()=>L(I("w-full justify-start text-secondary text-sm"))]),g(U,x)}),m(b),g(h,b)},A=h=>{var b=Ue();g(h,b)};S(v,h=>{M.length>0?h(w):h(A,!1)})}var y=q(v,2);y.__click=[ke,c];var j=q(p(y));K(j,{name:"plus"}),m(y),m(s),O((h,b)=>{C(s,1,h),C(y,1,b)},[()=>L(I("flex flex-col gap-4 w-[min(80ch,_100%)]",M.length===0&&"h-full justify-center")),()=>L(I(G.button({type:"positive"}),"mx-auto w-full"))]),g(t,s),Y(),n()}ve(["click","keydown"]);function st(t,e){const a=e?Be(e,t):{};return[...Ae,...Object.values(Le)].reduce((r,n)=>(t.getFilterType(n)=="number"?r[n]=a[n]??t.getMinAndMaxValues(n):t.getFilterType(n)=="string"?r[n]=a[n]||[]:t.getFilterType(n)=="object"&&(r[n]=a[n]||[]),r),{})}function it(t,e){return Object.entries(t).reduce((a,[r,n])=>{const o=e.getFilterType(r);if(o==="string"&&Array.isArray(n))a[r]=n;else if(o==="object")a[r]=Array.from(n);else if(o==="number"&&Array.isArray(n)){const i=e.getMinAndMaxValues(r);i&&i[0]==n[0]&&i[1]==n[1]?a[r]="":a[r]=`${n[0]}-${n[1]}`}return a},{})}function Be(t,e){return[...t.keys()].reduce((a,r)=>{const n=e.getFilterType(r);return{...a,[r]:n==="number"?t.get(r)?.split("-").map(o=>Number(o)):t.getAll(r)}},{})}function ot(t,e,a,r){const n=e.data.map(o=>{let i=0;a.forEach(s=>{const v=e.getFilterType(s);if(v==="number"&&typeof t[s]=="number"&&typeof o[s]=="number"){const w=Math.abs(t[s]-o[s]),A=Math.max(t[s]*.2,.01);i+=Math.max(0,1-w/A)}else v==="string"&&t[s]===o[s]&&(i+=1)});const c={[d.GrapeVarieties]:1,[d.Description]:1};return Object.keys(c).forEach(s=>{if(a.has(s)&&t[s]instanceof Set&&o[s]instanceof Set){let v=1;const w=t[s],A=o[s],y=w.intersection(A).size;v+=y/(Math.max(w.size,A.size)||1),v+=v*c[s],i*=v}}),{item:o,score:i}});return n.sort((o,i)=>i.score-o.score),n.filter(({item:o})=>o[d.Number]!==t[d.Number]).slice(0,r).map(({item:o})=>o)}function ie(t){let e=t[d.Name];return e=e.replace(/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})/g,""),e=e.toLowerCase(),e=e.replace(t[d.PackagingType].toLowerCase(),""),e=e.replace(/\w+-pack/g,""),e=e.replace(/[\d.,%\-]+/g,""),e=e.replace(/\s+/g," ").trim(),e}function ct(t,e){const a=ie(t),n=e.filter({[d.Type]:new Set([t[d.Type]]),[d.AlcoholPercentage]:[t[d.AlcoholPercentage],t[d.AlcoholPercentage]],[d.Vintage]:[t[d.Vintage],t[d.Vintage]]}).map(i=>{let c=0;const s=ie(i);return ue(a,s,.85)&&(c+=1),{item:i,score:c}}).sort((i,c)=>i.score-c.score).reverse(),o=[];for(let i=0;i<n.length;i++){const c=n[i];if(c.item[d.Number]!==t[d.Number])if(i===0)o.push(c.item);else if(c.score===n[i-1].score)o.push(c.item);else return o}return o}var Qe=T("<p><!> <span> </span></p>");function oe(t,e){W(e,!0);const a=ce(e,"color",3,"default");var r=Qe(),n=p(r);{var o=s=>{K(s,{get name(){return e.icon}})};S(n,s=>{e.icon&&s(o)})}var i=q(n,2),c=p(i,!0);m(i),m(r),O(s=>{C(r,1,s),te(c,e.text)},[()=>L(I(G.badge({color:a()})))]),g(t,r),Y()}function lt(t,e){W(e,!0);var a=D(),r=P(a);ae(r,17,()=>Object.entries(Ie(e.item)),re,(n,o)=>{var i=ne(()=>se(u(o),2));let c=()=>u(i)[0],s=()=>u(i)[1];var v=D(),w=P(v);{var A=y=>{var j=D(),h=P(j);{var b=f=>{oe(f,{get text(){return s().text},get color(){return s().color},get icon(){return s().icon}})},U=f=>{var x=D(),k=P(x);{var F=V=>{var N=D(),z=P(N);ae(z,17,()=>Object.entries(s()),re,(X,Z)=>{var R=ne(()=>se(u(Z),2));let J=()=>u(R)[0],B=()=>u(R)[1];var H=D(),$=P(H);{var _=l=>{oe(l,{get text(){return B().text},get color(){return B().color},get icon(){return B().icon}})};S($,l=>{e.item[c()]===J()&&l(_)})}g(X,H)}),g(V,N)};S(k,V=>{typeof s()=="object"&&!Array.isArray(s())&&s()!==null&&V(F)},!0)}g(f,x)};S(h,f=>{typeof s().text=="string"&&typeof s().color=="string"?f(b):f(U,!1)})}g(y,j)};S(w,y=>{e.item[c()]!==null&&s()&&y(A)})}g(n,v)}),g(t,a),Y()}function je(t,e,a){const r=`https://images.alko.fi/images/cs_srgb,f_auto,t_${a||"products"}/cdn`;e.toLowerCase,e=String(e);const n=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");return`${r}/${t}/${n}.jpg`}var Ne=T('<img crossorigin="anonymous" referrerpolicy="no-referrer" data-name="product-image"/>');function ut(t,e){W(e,!0);var a=Ne();O((r,n)=>{E(a,"src",r),E(a,"alt",e.name),C(a,1,n)},[()=>je(e.number,e.name,e.transform||"products"),()=>L(I("block h-full w-full object-contain",e.class))]),g(t,a),Y()}export{nt as A,lt as B,ut as P,et as a,Ze as b,$e as c,it as d,je as e,ot as f,Ye as g,ct as h,st as i,We as j,de as l,tt as r,rt as s,Me as u,at as v};
