import{p as oe,s as fe,a as de}from"./B1IEMRCk.js";import{j as me,a as X,i as S,m as g,o as D,q as f,v as O,d,e as Z,g as u,a7 as te,w as ge,b as V,f as z,aa as ne,ae as se}from"./Blx9tMFz.js";import{i as I}from"./D90skVT9.js";import{l as ce,e as ae,a as re,i as ve,s as U}from"./2tuZ5JlQ.js";import{l as M,I as W,g as A,t as L,h as Y,i as F,o as pe,v as _e,d as ye,A as G,y as he}from"./Dz1ThuZh.js";import{c as be,a as xe}from"./LXmW7SWr.js";function ue(){return`${Date.now()}-${be().split("-")[0]}`}function we(t){const e={id:ue(),name:t,items:[]};M.push(e)}function Ge(t){return M.find(e=>e.id===t)}function Ae(t){M.splice(M.indexOf(t),1)}function We(t,e){const a=t.items.find(r=>r.id===e);return a||null}function Le(t,e,a){const r=t.items.find(n=>n.id===e);r&&(r.q=a)}function Ye(t,e){return t.items.find(a=>a.id===e)?.q||0}function Xe(t,e){t.items.some(a=>a.id===e)?Le(t,e,(t.items.find(a=>a.id===e)?.q||0)+1):t.items.push({id:e,q:1})}function Ze(t,e){if(t.items.some(a=>a.id===e)){const a=t.items.find(r=>r.id===e);a&&(a.q-=1)}t.items=t.items.filter(a=>a.id!==e)}function le(t){return ce.compressToEncodedURIComponent(JSON.stringify(t))}function Fe(t){try{const e=JSON.parse(ce.decompressFromEncodedURIComponent(t));return Array.isArray(e.items)?e:null}catch{return null}}function Ne(t){const e=Fe(t);if(!e)return!1;const a=["id","name","items"];for(const r of a)if(!(r in e))return!1;if(!Array.isArray(e.items))return!1;for(const r of e.items)if(typeof r.id!="string"||typeof r.q!="number")return!1;return!0}function $e(t){const e={...t,id:ue()};return M.push(e),e}var Ie=(t,e,a)=>{e.action&&typeof e.action=="function"&&(t.preventDefault(),e.action(u(a)))},Me=()=>{},Se=async(t,e)=>{t.preventDefault(),t.stopPropagation(),await xe({title:`Alkometriikka - ${u(e).name}`,text:`Katso lista: ${u(e).name}`,url:`${location.origin}/listat?list=${le(u(e))}`})||alert("Linkki kopioitu leikepöydälle!")},Te=S('<button><!><span class="hidden md:block">Jaa</span></button>'),qe=(t,e)=>{t.preventDefault(),t.stopPropagation(),Ae(u(e))},Ce=S("<button><!></button>"),Ve=S('<a class="flex justify-between items-center gap-2 p-2 border rounded border-gray-300" tabindex="0"><div class="flex flex-col"><p><span> </span></p> <p><span> </span></p></div> <div class="flex items-center gap-3"><!> <!></div></a>'),ze=S('<div class="flex flex-col gap-4"></div>'),De=S('<div class="prose text-center mx-auto"><h2>Ei listoja!</h2> <p>Luo uusi lista alla olevasta painikkeesta!</p></div>'),Oe=(t,e)=>e(),Ue=S("<div><!> <button><span>Uusi lista</span><!></button></div>");function et(t,e){X(e,!0);const a=()=>de(pe,"$searchQuery",r),[r,n]=fe(),i=oe(e,"useSearch",3,!1),o=new Date;function y(){we(`Uusi lista - ${o.getDate()}.${o.getMonth()+1}.${o.getFullYear()} ${o.getHours()<10?"0":""}${o.getHours()}.${o.getMinutes()<10?"0":""}${o.getMinutes()}`)}var s=Ue(),m=g(s);{var x=_=>{var h=ze();ae(h,21,()=>M.filter(B=>i()&&a()?ve(B.name,a()):!0),re,(B,l)=>{var b=Ve();b.__click=[Ie,e,l],b.__keydown=[Me];var E=g(b),T=g(E),q=g(T),J=g(q,!0);f(q),f(T);var C=D(T,2),H=g(C),N=g(H,!0);f(H),f(C),f(E);var R=D(E,2),K=g(R);{var P=v=>{var c=Te();c.__click=[Se,l];var Q=g(c);W(Q,{name:"share",class:"inline-block "}),ge(),f(c),O(ee=>F(c,1,ee),[()=>A(L(Y.button({type:"positive",size:"md"}),"aspect-square md:aspect-auto"))]),d(v,c)};I(K,v=>{e.show?.share&&v(P)})}var k=D(K,2);{var $=v=>{var c=Ce();c.__click=[qe,l];var Q=g(c);W(Q,{name:"trash"}),f(c),O(ee=>{U(c,"aria-label",u(l).name),F(c,1,ee)},[()=>A(L(Y.button({type:"negative",size:"md"}),"aspect-square w-fit"))]),d(v,c)};I(k,v=>{e.show?.delete&&v($)})}f(R),f(b),O((v,c,Q)=>{U(b,"href",v),U(T,"aria-label",u(l).name),F(T,1,c),te(J,u(l).name),U(C,"aria-label",u(l).name),F(C,1,Q),te(N,`Tuotteet: ${u(l).items.length}`)},[()=>`/listat?list=${le(u(l))}`,()=>A(L("w-full justify-start text-lg")),()=>A(L("w-full justify-start text-gray-600 text-sm"))]),d(B,b)}),f(h),d(_,h)},w=_=>{var h=De();d(_,h)};I(m,_=>{M.length>0?_(x):_(w,!1)})}var p=D(m,2);p.__click=[Oe,y];var j=D(g(p));W(j,{name:"plus"}),f(p),f(s),O((_,h)=>{F(s,1,_),F(p,1,h)},[()=>A(L("flex flex-col gap-4 w-[min(80ch,_100%)]",M.length===0&&"h-full justify-center")),()=>A(L(Y.button({type:"positive"}),"mx-auto w-full"))]),d(t,s),Z(),n()}me(["click","keydown"]);function tt(t,e){const a=e?Be(e,t):{};return[..._e,...Object.values(ye)].reduce((r,n)=>(t.getFilterType(n)=="number"?r[n]=a[n]??t.getMinAndMaxValues(n):t.getFilterType(n)=="string"?r[n]=a[n]||[]:t.getFilterType(n)=="object"&&(r[n]=a[n]||[]),r),{})}function at(t,e){return Object.entries(t).reduce((a,[r,n])=>{const i=e.getFilterType(r);if(i==="string"&&Array.isArray(n))a[r]=n;else if(i==="object")a[r]=Array.from(n);else if(i==="number"&&Array.isArray(n)){const o=e.getMinAndMaxValues(r);o&&o[0]==n[0]&&o[1]==n[1]?a[r]="":a[r]=`${n[0]}-${n[1]}`}return a},{})}function Be(t,e){return[...t.keys()].reduce((a,r)=>{const n=e.getFilterType(r);return{...a,[r]:n==="number"?t.get(r)?.split("-").map(i=>Number(i)):t.getAll(r)}},{})}function rt(t,e,a,r){const n=e.data.map(i=>{let o=0;a.forEach(s=>{const m=e.getFilterType(s);if(m==="number"&&typeof t[s]=="number"&&typeof i[s]=="number"){const x=Math.abs(t[s]-i[s]),w=Math.max(t[s]*.2,.01);o+=Math.max(0,1-x/w)}else m==="string"&&t[s]===i[s]&&(o+=1)});const y={[G.GrapeVarieties]:1,[G.Description]:1};return Object.keys(y).forEach(s=>{if(a.has(s)&&t[s]instanceof Set&&i[s]instanceof Set){let m=1;const x=t[s],w=i[s],p=x.intersection(w).size;m+=p/(Math.max(x.size,w.size)||1),m+=m*y[s],o*=m}}),{item:i,score:o}});return n.sort((i,o)=>o.score-i.score),n.filter(({item:i})=>i[G.Number]!==t[G.Number]).slice(0,r).map(({item:i})=>i)}var Ee=S("<p><!> <span> </span></p>");function ie(t,e){X(e,!0);const a=oe(e,"color",3,"default");var r=Ee(),n=g(r);{var i=s=>{W(s,{get name(){return e.icon}})};I(n,s=>{e.icon&&s(i)})}var o=D(n,2),y=g(o,!0);f(o),f(r),O(s=>{F(r,1,s),te(y,e.text)},[()=>A(L(Y.badge({color:a()})))]),d(t,r),Z()}function nt(t,e){X(e,!0);var a=V(),r=z(a);ae(r,17,()=>Object.entries(he(e.item)),re,(n,i)=>{var o=ne(()=>se(u(i),2));let y=()=>u(o)[0],s=()=>u(o)[1];var m=V(),x=z(m);{var w=p=>{var j=V(),_=z(j);{var h=l=>{ie(l,{get text(){return s().text},get color(){return s().color},get icon(){return s().icon}})},B=l=>{var b=V(),E=z(b);{var T=q=>{var J=V(),C=z(J);ae(C,17,()=>Object.entries(s()),re,(H,N)=>{var R=ne(()=>se(u(N),2));let K=()=>u(R)[0],P=()=>u(R)[1];var k=V(),$=z(k);{var v=c=>{ie(c,{get text(){return P().text},get color(){return P().color},get icon(){return P().icon}})};I($,c=>{e.item[y()]===K()&&c(v)})}d(H,k)}),d(q,J)};I(E,q=>{typeof s()=="object"&&!Array.isArray(s())&&s()!==null&&q(T)},!0)}d(l,b)};I(_,l=>{typeof s().text=="string"&&typeof s().color=="string"?l(h):l(B,!1)})}d(p,j)};I(x,p=>{e.item[y()]!==null&&s()&&p(w)})}d(n,m)}),d(t,a),Z()}function Re(t,e,a){const r=`https://images.alko.fi/images/cs_srgb,f_auto,t_${a||"products"}/cdn`;e.toLowerCase,e=String(e);const n=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");return`${r}/${t}/${n}.jpg`}var Pe=S('<img crossorigin="anonymous" referrerpolicy="no-referrer"/>');function st(t,e){X(e,!0);var a=Pe();O((r,n)=>{U(a,"src",r),U(a,"alt",e.name),F(a,1,n)},[()=>Re(e.number,e.name,e.transform||"products"),()=>A(L("block h-full w-full object-contain",e.class))]),d(t,a),Z()}export{et as A,nt as B,st as P,Xe as a,We as b,Ye as c,at as d,rt as f,Ge as g,tt as i,le as l,Ze as r,$e as s,Le as u,Ne as v};
