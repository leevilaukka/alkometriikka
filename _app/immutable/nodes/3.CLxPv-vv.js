import{v as We,g as Xe,i as Ze,l as zt,s as ta,b as ea,r as aa,u as ra,c as oa,A as me,a as sa}from"../chunks/Bd-HB-3y.js";import{e as la}from"../chunks/D5gDvuDJ.js";import{l as na,r as se,s as Gt,e as le,a as ne,b as ie}from"../chunks/2tuZ5JlQ.js";import{a as Bt,s as ia}from"../chunks/B1IEMRCk.js";import{j as fe,a as ge,k as ot,a9 as yt,a8 as da,a1 as de,g as t,u as ua,aa as Q,i as g,f as B,m as a,o as r,q as e,v as k,d as c,e as be,ad as ue,a7 as q,n as Lt,s as tt,w as Ht,b as At,ab as va,ac as ca}from"../chunks/Blx9tMFz.js";import{P as _a,a as pa}from"../chunks/Bk0acZ1W.js";import{i as T,b as Kt}from"../chunks/D90skVT9.js";import{C as ma,e as ve,I as A,g as _,t as p,h as b,i as m,q as fa,p as mt,m as ga,n as ba,j as xa,o as ha,k as ka,A as D,G as Ot}from"../chunks/Dz1ThuZh.js";import{b as ce}from"../chunks/_P1QabsG.js";import{p as wa,a as ya,h as _e,s as La,g as pe}from"../chunks/LXmW7SWr.js";import{K as Aa}from"../chunks/pR69dnPu.js";import{S as Sa,P as Ca}from"../chunks/By9aO5cc.js";import{F as Fa}from"../chunks/DgZ9aPTJ.js";import{g as xe}from"../chunks/o1WFV9BS.js";async function Pa({parent:F,url:l}){const S=await F(),X=l.searchParams.get("list"),K=X&&We(X),I=K?JSON.parse(na.decompressFromEncodedURIComponent(X)):null;return X&&!K&&la(400,{message:"Listan tietoja ei voida lukea. Tarkista linkki."}),{...S,list:I}}const hr=Object.freeze(Object.defineProperty({__proto__:null,load:Pa},Symbol.toStringTag,{value:"Module"}));var $a=()=>window.history.length>1?window.history.back():xe("/"),qa=(F,l)=>{l()},ja=g('<button><!> <span class="hidden md:block">Tiedot</span></button> <button><!><span class="hidden md:block">Jaa</span></button>',1),Na=g('<input type="text" name="listName" class="w-full border-none bg-transparent p-0 text-2xl leading-none focus:ring-0"/> <!>',1),Ta=g('<h2 class="text-lg leading-none md:text-2xl"> </h2> <button><span>Tallenna lista</span> <!></button>',1),Ia=g('<div class="grid flex-auto place-content-center"><div class="mx-auto prose text-center"><h2>Lista on tyhjä!</h2> <p>Lisää tuotteita listaan tuotevalikosta!</p> <a href="/"><span>Tuotevalikkoon</span> <!></a></div></div>'),Va=g('<aside class="z-10 flex h-full flex-col overflow-hidden border-gray-300 md:w-84 md:border-e"><!></aside>'),Ea=g("<option> </option>"),Ma=(F,l,S)=>{tt(l,!t(l)),t(S)?.scroll({index:0,smoothScroll:!1})},za=g('<button><span class="hidden whitespace-nowrap md:block"> </span> <!></button>'),Ga=g("<option> </option>"),Ba=(F,l)=>{t(l)?.toggleFilterElement()},Ka=g("<button><span>Näytä suodattimet</span> <!></button>"),Oa=(F,l)=>{t(l)?.scroll({index:0,smoothScroll:!1})},Ha=(F,l,S)=>{l(S(),-1)},Qa=(F,l,S)=>{l(S(),1)},Da=g('<div><button><!></button> <input type="number"/> <button><!></button></div>'),Ra=g("<button><span>Poista listasta</span> <!></button>"),Ja=(F,l)=>l().showModal(),Ua=g("<button><span>Lisää listaan</span> <!></button>"),Ya=g('<h2 class="text-xl">Valitse lista</h2> <!>',1),Wa=g('<div class="absolute top-0 left-0 flex flex-nowrap items-center gap-0.5 rounded-br bg-gray-100 px-1.5 py-0.5 text-sm text-gray-500"><!> <span> </span></div> <!> <!>',1),Xa=(F,l)=>{l()},Za=g('<div class="flex flex-row flex-wrap justify-end gap-4"><button>Sulje</button></div>'),tr=g('<!> <main class="mx-auto flex h-full w-full flex-col gap-3 bg-gray-50 p-3 md:gap-4 md:p-6"><div class="flex w-full flex-col items-start gap-4"><div><div class="flex flex-col"><label class="text-sm"></label> <div class="flex flex-row flex-nowrap"><select name="sortingColumn" id="sortingColumn"></select> <!></div></div> <div class="flex flex-col"><label class="text-sm"></label> <select name="selectedHighlight" id="selectedHighlight"></select></div></div></div> <div class="flex flex-row flex-nowrap items-center justify-between gap-2"><!> <button><!> <span> </span></button></div> <div class="flex flex-auto flex-col"><!></div></main> <aside class="z-10 flex h-full flex-col overflow-x-hidden overflow-y-auto border-gray-300 xl:border-s"><dialog><h2 class="text-2xl font-bold">Listan tiedot</h2> <div class="flex flex-auto flex-col gap-4"><p> </p> <p> </p> <p> </p> <p> </p> <p> </p> <p> </p> <div class=" mt-auto flex flex-row items-center justify-center gap-3 rounded border border-gray-300 bg-white p-1 text-center text-2xl font-bold"><!> <h2> </h2></div></div> <!></dialog></aside>',1),er=g('<div class="flex flex-row items-center justify-between gap-4 border-b border-gray-300 p-3 md:p-4"><button><!> <span class="hidden md:block"></span></button> <!></div> <div><!></div>',1);function ar(F,l){ge(l,!0);const S=()=>Bt(fa,"$isLaptop",I),X=()=>Bt(ha,"$searchQuery",I),K=()=>Bt(xa,"$isMobile",I),[I,ft]=ia();let gt=ot(yt([])),St=da(ma.SearchParamsManager);const dt=Xe(l.list.id),d=dt||l.list,st=Q(()=>wa(l.dataset,d.items.map(s=>s.id))),w=Q(()=>new Aa(t(st),mt));let R=ot(null),j=ot(null);function lt(){t(j)&&(t(j).open?t(j).close():S()?t(j).showModal():t(j).show())}de(()=>{t(j)?.open&&t(j).close(),!S()&&t(j)?.show()});let ut=ot(null),vt=ot(yt(Ze(ua(()=>t(w))))),ct=ot(yt(ve)),Z=ot(yt(ve)),bt=Q(()=>ka[t(Z)]||!1),he=Q(()=>{let s={...t(vt)};Object.keys(s).forEach(u=>{Array.isArray(s[u])&&t(w).getFilterType(u)!=="number"&&(s[u]=new Set(s[u]))});let i=t(w).fuzzySearchAndFilter(X(),s);return t(Z)&&(i=i.sort((u,C)=>u[t(Z)]>C[t(Z)]?1:-1)),t(bt)||(i=i.reverse()),i});function ke(){let s=0,i=0,u=0,C=0,y=0;d.items.forEach(x=>{const V=t(w).data.find(J=>J[D.Number]===x.id);V&&(u+=x.q,s+=V[D.Price]*x.q,i+=V[D.AlcoholGrams]*x.q,C+=(V[D.Sugar]||0)*x.q,y+=V[D.BottleSize]*x.q)});const L=s>0?i/s:0,N=i/((mt.weight||(mt.gender===Ot.Female?76:mt.gender===Ot.Male?86:79))*(mt.gender===Ot.Male?.68:.55));return{totalPrice:s.toFixed(2),totalAlcoholGrams:i.toFixed(2),totalAlcoholGramsPerEuro:L.toFixed(2),totalItems:u,totalSugar:C.toFixed(2),totalBAC:N.toFixed(2),totalVolume:y.toFixed(2)}}let et=Q(ke);function we(s){s.trim().length===0?d.name="Nimetön lista":d.name=s.trim()}function Qt(s,i){ra(d,s[D.Number],oa(d,s[D.Number])+i)}de(()=>{St.setParameter("list",zt(d))});var ye={toggleDetailsElement:lt},Dt=er(),Ct=B(Dt),_t=a(Ct);_t.__click=[$a];var Rt=a(_t);A(Rt,{name:"arrow_back",class:"inline-block"});var Le=r(Rt,2);Le.textContent=window.history.length>1?"Takaisin":"Etusivulle",e(_t);var Ae=r(_t,2);{var Se=s=>{var i=Na(),u=B(i);se(u);var C=r(u,2);{var y=L=>{var N=ja(),x=B(N);x.__click=[qa,lt];var V=a(x);A(V,{name:"sidebar",class:"inline-block "}),Ht(2),e(x);var J=r(x,2);J.__click=async()=>{await ya({title:`Alkometriikka - ${d.name}`,text:`Katso lista: ${d.name}`,url:`${location.origin}/listat?list=${zt(d)}`})||alert("Linkki kopioitu leikepöydälle!")};var at=a(J);A(at,{name:"share",class:"inline-block "}),Ht(),e(J),k((xt,Pt)=>{m(x,1,xt),m(J,1,Pt)},[()=>_(p(b.button({size:"md"}),"aspect-square md:aspect-auto")),()=>_(p(b.button({type:"positive",size:"md"}),"aspect-square md:aspect-auto"))]),c(L,N)};T(C,L=>{d.items.length>0&&L(y)})}ue("blur",u,()=>we(d.name)),ce(u,()=>d.name,L=>d.name=L),c(s,i)},Ce=s=>{var i=Ta(),u=B(i),C=a(u,!0);e(u);var y=r(u,2);y.__click=()=>{const N=ta(d);xe(`?list=${zt(N)}`)};var L=r(a(y),2);A(L,{name:"save"}),e(y),k(N=>{q(C,d.name),m(y,1,N)},[()=>_(p(b.button({type:"positive",size:"md"})))]),c(s,i)};T(Ae,s=>{dt?s(Se):s(Ce,!1)})}e(Ct);var Ft=r(Ct,2),Fe=a(Ft);{var Pe=s=>{var i=Ia(),u=a(i),C=r(a(u),4),y=r(a(C),2);A(y,{name:"arrow_right_stroke"}),e(C),e(u),e(i),k(L=>m(C,1,L),[()=>_(p(b.button({type:"positive"}),"mx-auto w-full"))]),c(s,i)},$e=s=>{var i=tr(),u=B(i);{var C=n=>{var o=Va(),v=a(o);Kt(Fa(v,{get kaljakori(){return t(w)},useURLParams:!1,get filterValues(){return t(vt)},set filterValues(f){tt(vt,f,!0)},get activeFilters(){return t(gt)},set activeFilters(f){tt(gt,f,!0)}}),f=>tt(ut,f,!0),()=>t(ut)),e(o),c(n,o)};T(u,n=>{t(w).data.length>1&&n(C)})}var y=r(u,2),L=a(y),N=a(L),x=a(N),V=a(x);Gt(V,"for","sortingColumn"),V.textContent="Järjestys";var J=r(V,2),at=a(J);le(at,21,()=>ga,ne,(n,o)=>{const v=Q(()=>t(w).getFilterValues(t(o)).length>0);var f=At(),h=B(f);{var U=E=>{var P=Ea(),nt=a(P,!0);e(P);var Y={};k(it=>{q(nt,it),Y!==(Y=t(o))&&(P.value=(P.__value=t(o))??"")},[()=>_e(t(o))]),c(E,P)};T(h,E=>{t(v)&&E(U)})}c(n,f)}),e(at);var xt=r(at,2);{var Pt=n=>{var o=za();o.__click=[Ma,bt,R];var v=a(o),f=a(v,!0);e(v);var h=r(v,2);{let U=Q(()=>t(bt)?"up_arrow_alt":"down_arrow_alt");A(h,{get name(){return t(U)}})}e(o),k((U,E)=>{m(o,1,U),q(f,E)},[()=>_(p(b.button(),"rounded-none rounded-e border-s-0")),()=>La(t(bt),t(Z))]),c(n,o)};T(xt,n=>{t(Z)&&n(Pt)})}e(J),e(x);var Jt=r(x,2),$t=a(Jt);Gt($t,"for","selectedHighlight"),$t.textContent="Korostus";var ht=r($t,2);le(ht,21,()=>ba,ne,(n,o)=>{const v=Q(()=>t(w).getFilterValues(t(o)).length>0);var f=At(),h=B(f);{var U=E=>{var P=Ga(),nt=a(P,!0);e(P);var Y={};k(it=>{q(nt,it),Y!==(Y=t(o))&&(P.value=(P.__value=t(o))??"")},[()=>_e(t(o))]),c(E,P)};T(h,E=>{t(v)&&E(U)})}c(n,f)}),e(ht),e(Jt),e(N),e(L);var qt=r(L,2),Ut=a(qt);{var je=n=>{var o=Ka();o.__click=[Ba,ut];var v=r(a(o),2);A(v,{name:"filter"}),e(o),k(f=>m(o,1,f),[()=>_(p(b.button(),"w-full"))]),c(n,o)};T(Ut,n=>{K()&&n(je)})}var kt=r(Ut,2);kt.__click=[Oa,R];var Yt=a(kt);A(Yt,{name:"arrow_to_top"});var Wt=r(Yt,2),Ne=a(Wt,!0);e(Wt),e(kt),e(qt);var Xt=r(qt,2),Te=a(Xt);Kt(Sa(Te,{get items(){return t(he)},itemsClass:"flex flex-col gap-3",renderItem:(o,v=Lt,f=Lt)=>{const h=Q(()=>ea(d,v()[D.Number]));{const U=P=>{var nt=Wa(),Y=B(nt),it=a(Y);A(it,{name:"hashtag"});var re=r(it,2),He=a(re,!0);e(re),e(Y);var oe=r(Y,2);{var Qe=O=>{var M=Da(),W=a(M);W.__click=[Ha,Qt,v];var rt=a(W);A(rt,{name:"minus"}),e(W);var z=r(W,2);se(z),Gt(z,"min",1),z.__input=G=>{const H=G.target;H&&H.valueAsNumber<=1&&(H.valueAsNumber=1,t(h).q=1)};var $=r(z,2);$.__click=[Qa,Qt,v];var pt=a($);A(pt,{name:"plus"}),e($),e(M),k((G,H,Ue,Ye)=>{m(M,1,G),m(W,1,H),W.disabled=t(h).q===1,m(z,1,Ue),m($,1,Ye)},[()=>_(p("flex flex-row")),()=>_(p(b.button(),"rounded-e-none border-e-0",t(h).q===1&&"cursor-not-allowed opacity-50")),()=>_(p(b.input(),"hide-number-input w-[6ch] rounded-none text-center")),()=>_(p(b.button(),"rounded-s-none border-s-0"))]),ue("blur",z,G=>{const H=G.target;H&&(!H.value||H.valueAsNumber<=1)&&(H.valueAsNumber=1,t(h).q=1)}),ce(z,()=>t(h).q,G=>t(h).q=G),c(O,M)};T(oe,O=>{t(h)&&O(Qe)})}var De=r(oe,2);{var Re=O=>{var M=Ra();M.__click=()=>aa(d,v()[D.Number]);var W=r(a(M),2);A(W,{name:"trash"}),e(M),k(rt=>m(M,1,rt),[()=>_(p(b.button({type:"negative"})))]),c(O,M)},Je=O=>{_a(O,{class:"gap-4 p-4",renderButton:(rt,z=Lt)=>{var $=Ua();$.__click=[Ja,z];var pt=r(a($),2);A(pt,{name:"plus"}),e($),k(G=>m($,1,G),[()=>_(p(b.button({type:"positive"})))]),c(rt,$)},renderContent:(rt,z=Lt)=>{var $=Ya(),pt=r(B($),2);me(pt,{action:G=>{sa(G,v()[D.Number]),z().close()}}),c(rt,$)},$$slots:{renderButton:!0,renderContent:!0}})};T(De,O=>{dt?O(Re):O(Je,!1)})}k(()=>q(He,`${f()+1}`)),c(P,nt)};let E=Q(()=>t(h)?.q);Ca(o,{get product(){return v()},get quantity(){return t(E)},get highlight(){return t(ct)},get kaljakori(){return t(w)},renderExtras:U,$$slots:{renderExtras:!0}})}},$$slots:{renderItem:!0}}),o=>tt(R,o,!0),()=>t(R)),e(Xt),e(y);var Zt=r(y,2),wt=a(Zt),jt=r(a(wt),2),Nt=a(jt),Ie=a(Nt);e(Nt);var Tt=r(Nt,2),Ve=a(Tt);e(Tt);var It=r(Tt,2),Ee=a(It);e(It);var Vt=r(It,2),Me=a(Vt);e(Vt);var Et=r(Vt,2),ze=a(Et);e(Et);var Mt=r(Et,2),Ge=a(Mt);e(Mt);var te=r(Mt,2),ee=a(te);A(ee,{name:"shopping_bag"});var ae=r(ee,2),Be=a(ae);e(ae),e(te),e(jt);var Ke=r(jt,2);{var Oe=n=>{var o=Za(),v=a(o);v.__click=[Xa,lt],e(o),k(f=>m(v,1,f),[()=>_(p(b.button({type:"negative"})))]),c(n,o)};T(Ke,n=>{S()&&n(Oe)})}e(wt),Kt(wt,n=>tt(j,n),()=>t(j)),e(Zt),k((n,o,v,f,h)=>{m(N,1,n),m(at,1,o),m(ht,1,v),m(kt,1,f),q(Ne,K()?"Alkuun":"Hyppää alkuun"),m(wt,1,h),q(Ie,`Tuotteita listassa: ${t(et).totalItems??""}`),q(Ve,`Kokonaismäärä: ${t(et).totalVolume??""} L`),q(Ee,`Yhteensä alkoholia: ${t(et).totalAlcoholGrams??""} g`),q(Me,`Yhteensä sokeria: ${t(et).totalSugar??""} g`),q(ze,`Alkoholia per euro: ${t(et).totalAlcoholGramsPerEuro??""} g/€`),q(Ge,`Arvioitu promillemäärä: ${t(et).totalBAC??""} ‰`),q(Be,`Yhteensä: ${t(et).totalPrice??""} €`)},[()=>_(p("grid w-full grid-cols-2 items-end gap-2 md:w-fit")),()=>_(p(b.input(),"w-full rounded-none rounded-s pe-8")),()=>_(p(b.input(),"w-full pe-8")),()=>_(p(b.button(),"ml-auto")),()=>_(p("fixed m-auto hidden h-full w-full flex-col gap-4 rounded-lg border border-gray-200 p-4 backdrop:backdrop-blur-sm open:flex xl:relative xl:w-84 xl:rounded-none xl:border-0"))]),ie(at,()=>t(Z),n=>tt(Z,n)),ie(ht,()=>t(ct),n=>tt(ct,n)),c(s,i)};T(Fe,s=>{t(w).data.length===0?s(Pe):s($e,!1)})}e(Ft),k((s,i)=>{m(_t,1,s),m(Ft,1,i)},[()=>_(p(b.button({size:"md"}),"aspect-square md:aspect-auto")),()=>_(p("relative grid h-full max-h-full grid-cols-[1fr_auto] overflow-hidden",t(w).data.length>1&&"grid-cols-[auto_1fr_auto]"))]),c(F,Dt);var qe=be(ye);return ft(),qe}fe(["click","input"]);var rr=()=>window.history.back(),or=g('<div><div class="flex w-full items-center gap-4"><button><!> <span>Takaisin</span></button></div> <div class="flex flex-col flex-auto gap-4 items-center"><!></div></div>'),sr=g('<div class="grid h-full w-full place-content-center"><div class="flex flex-col items-center gap-3"><span class="block h-16 w-16 animate-spin rounded-full border-[0.5rem] border-red-600 border-b-transparent"></span> <p>Ladataan...</p></div></div>');function kr(F,l){ge(l,!0);var S=At();va(K=>{k(I=>ca.title=I,[()=>l.data.list?pe(`Lista - ${l.data.list.name}`):pe("Listat")])});var X=B(S);pa(X,()=>l.data.alko,K=>{var I=sr();c(K,I)},(K,I)=>{var ft=At(),gt=B(ft);{var St=d=>{ar(d,{get dataset(){return t(I).dataset.table},get list(){return l.data.list}})},dt=d=>{var st=or(),w=a(st),R=a(w);R.__click=[rr];var j=a(R);A(j,{name:"arrow_back",class:"inline-block"}),Ht(2),e(R),e(w);var lt=r(w,2),ut=a(lt);me(ut,{useSearch:!0,show:{delete:!0,share:!0}}),e(lt),e(st),k((vt,ct)=>{m(st,1,vt),m(R,1,ct)},[()=>_(p("flex flex-col gap-4 w-[min(80ch,_100%)] mx-auto p-4")),()=>_(p(b.button({size:"md"})))]),c(d,st)};T(gt,d=>{l.data.list?d(St):d(dt,!1)})}c(K,ft)}),c(F,S),be()}fe(["click"]);export{kr as component,hr as universal};
